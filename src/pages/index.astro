---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import ProjectMarquee from '../components/ProjectMarquee.astro';
import ExperienceTimeline from '../components/ExperienceTimeline.astro';
import CompanyLogos from '../components/CompanyLogos.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');
const githubRepos = await getCollection('githubRepos');

const repoMap = new Map<string, (typeof githubRepos)[number]>();
for (const repo of githubRepos) {
  repoMap.set(repo.data.name, repo);
}

function enrichProject(project: (typeof allProjects)[number]) {
  const gh = repoMap.get(project.data.repoName);
  return {
    title: project.data.title,
    description: project.data.description,
    category: project.data.category,
    tags: project.data.tags,
    repoUrl: gh?.data.url ?? `https://github.com/bennlaufer/${project.data.repoName}`,
    stars: gh?.data.stars,
    forks: gh?.data.raw?.forks_count,
    language: gh?.data.raw?.language ?? undefined,
  };
}

const featured = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.displayOrder - b.data.displayOrder)
  .slice(0, 3)
  .map(enrichProject);

const allProjectsEnriched = allProjects
  .sort((a, b) => a.data.displayOrder - b.data.displayOrder)
  .map(enrichProject);
---

<BaseLayout title="Ben Laufer — Data Science & AI Agent Development">
  <!-- Header — just the name -->
  <section slot="hero" class="relative flex items-center justify-center text-center overflow-hidden pt-36 pb-20 sm:pt-44 sm:pb-24">
    <div class="absolute inset-0 bg-gradient-to-b from-slate-900 via-slate-900 to-slate-950"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[400px] bg-accent-blue/5 rounded-full blur-3xl"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/3 w-[600px] h-[300px] bg-accent-purple/5 rounded-full blur-3xl"></div>
    <h1 class="relative z-10 text-7xl sm:text-8xl lg:text-9xl font-extrabold tracking-tight uppercase leading-none animate-fade-in-up">
      <span class="bg-gradient-to-r from-white via-gray-100 to-gray-300 bg-clip-text text-transparent">Ben</span>
      <span class="ml-4 sm:ml-6 bg-gradient-to-r from-accent-blue to-accent-purple bg-clip-text text-transparent">Laufer</span>
    </h1>
  </section>

  <!-- Summary -->
  <section class="py-12 animate-fade-in-up" style="animation-delay: 0.1s">
    <h2 class="text-2xl font-bold text-white mb-4">Summary</h2>
    <p class="text-gray-400 max-w-3xl leading-relaxed">
      Thanks for checking out my portfolio! No matter how you found your way here, I hope you enjoy exploring what I've built.
    </p>
  </section>

  <!-- Experience -->
  <section class="pb-12 animate-fade-in-up" style="animation-delay: 0.15s">
    <h2 class="text-2xl font-bold text-white mb-6">Experience</h2>
    <CompanyLogos />
  </section>
  <section class="pb-16 animate-fade-in-up" style="animation-delay: 0.2s">
    <ExperienceTimeline />
  </section>

  <!-- Featured Projects -->
  <section class="pb-16 animate-fade-in-up" style="animation-delay: 0.3s">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl font-bold text-white">Featured Projects</h2>
      <a href="/projects" class="text-sm text-accent-blue hover:text-accent-blue/80 transition-colors">
        View All Projects &rarr;
      </a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {featured.map((project) => (
        <ProjectCard {...project} />
      ))}
    </div>
  </section>

  <ProjectMarquee slot="pre-footer" projects={allProjectsEnriched} />
</BaseLayout>
