---
interface Project {
  title: string;
  description: string;
  category: string;
  tags: string[];
  repoUrl: string;
  stars?: number;
  forks?: number;
  language?: string;
}

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
const duration = projects.length * 5;
---

<section class="py-16">
  <div class="max-w-5xl mx-auto px-6 lg:px-10 mb-8">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-bold text-white">Projects</h2>
      <a href="/projects" class="text-sm text-accent-blue hover:text-accent-blue/80 transition-colors">
        View All Projects &rarr;
      </a>
    </div>
  </div>

  <div class="max-w-5xl mx-auto px-6 lg:px-10 relative overflow-hidden">
    <!-- Left fade -->
    <div class="absolute left-0 top-0 bottom-0 w-16 sm:w-32 bg-gradient-to-r from-slate-950 to-transparent z-10 pointer-events-none"></div>
    <!-- Right fade -->
    <div class="absolute right-0 top-0 bottom-0 w-16 sm:w-32 bg-gradient-to-l from-slate-950 to-transparent z-10 pointer-events-none"></div>

    <div class="marquee-track flex gap-6 w-max" style={`--marquee-duration: ${duration}s`}>
      {/* First set */}
      {projects.map((project) => (
        <a
          href={project.repoUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="group block w-72 sm:w-80 flex-shrink-0 rounded-xl border border-slate-700/50 bg-white/5 backdrop-blur-sm p-6 transition-all duration-300 hover:scale-[1.02] hover:border-accent-blue/50 hover:shadow-lg hover:shadow-accent-blue/10"
        >
          <h3 class="text-lg font-semibold text-white group-hover:text-accent-blue transition-colors mb-2 truncate">
            {project.title}
          </h3>
          <p class="text-sm text-gray-400 leading-relaxed mb-4 line-clamp-2">
            {project.description}
          </p>
          <div class="flex flex-wrap gap-2 mb-4">
            {project.tags.slice(0, 3).map((tag) => (
              <span class="text-xs px-2 py-1 rounded-full bg-slate-700/50 text-gray-300">
                {tag}
              </span>
            ))}
          </div>
          <div class="flex items-center gap-4 text-xs text-gray-500">
            {project.language && (
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-accent-blue/60"></span>
                {project.language}
              </span>
            )}
            {(project.stars !== undefined && project.stars > 0) && (
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279L12 19.771l-7.416 3.642 1.48-8.279L0 9.306l8.332-1.151z"/>
                </svg>
                {project.stars}
              </span>
            )}
            {(project.forks !== undefined && project.forks > 0) && (
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M6 3a3 3 0 013 3c0 1.29-.813 2.39-1.956 2.816.017.614.104 1.049.29 1.389.26.476.75.842 1.528 1.126.858.313 2.003.487 3.138.487s2.28-.174 3.138-.487c.778-.284 1.268-.65 1.528-1.126.186-.34.273-.775.29-1.389A3.001 3.001 0 0115 6a3 3 0 013 3c0 1.29-.813 2.39-1.956 2.816-.021.88-.182 1.63-.558 2.317-.492.9-1.34 1.573-2.428 1.97-1.066.389-2.36.597-3.558.597s-2.492-.208-3.558-.597c-1.088-.397-1.936-1.07-2.428-1.97-.376-.687-.537-1.438-.558-2.317A3.001 3.001 0 013 9a3 3 0 013-6zm0 2a1 1 0 100 2 1 1 0 000-2zm12 0a1 1 0 100 2 1 1 0 000-2zM12 21a3 3 0 01-3-3c0-1.29.813-2.39 1.956-2.816A3.001 3.001 0 0112 15a3 3 0 011.044.184A3.001 3.001 0 0115 18a3 3 0 01-3 3zm0-4a1 1 0 100 2 1 1 0 000-2z"/>
                </svg>
                {project.forks}
              </span>
            )}
          </div>
        </a>
      ))}
      {/* Duplicate set for seamless loop */}
      {projects.map((project) => (
        <a
          href={project.repoUrl}
          target="_blank"
          rel="noopener noreferrer"
          aria-hidden="true"
          tabindex="-1"
          class="group block w-72 sm:w-80 flex-shrink-0 rounded-xl border border-slate-700/50 bg-white/5 backdrop-blur-sm p-6 transition-all duration-300 hover:scale-[1.02] hover:border-accent-blue/50 hover:shadow-lg hover:shadow-accent-blue/10"
        >
          <h3 class="text-lg font-semibold text-white group-hover:text-accent-blue transition-colors mb-2 truncate">
            {project.title}
          </h3>
          <p class="text-sm text-gray-400 leading-relaxed mb-4 line-clamp-2">
            {project.description}
          </p>
          <div class="flex flex-wrap gap-2 mb-4">
            {project.tags.slice(0, 3).map((tag) => (
              <span class="text-xs px-2 py-1 rounded-full bg-slate-700/50 text-gray-300">
                {tag}
              </span>
            ))}
          </div>
          <div class="flex items-center gap-4 text-xs text-gray-500">
            {project.language && (
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-accent-blue/60"></span>
                {project.language}
              </span>
            )}
            {(project.stars !== undefined && project.stars > 0) && (
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279L12 19.771l-7.416 3.642 1.48-8.279L0 9.306l8.332-1.151z"/>
                </svg>
                {project.stars}
              </span>
            )}
            {(project.forks !== undefined && project.forks > 0) && (
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M6 3a3 3 0 013 3c0 1.29-.813 2.39-1.956 2.816.017.614.104 1.049.29 1.389.26.476.75.842 1.528 1.126.858.313 2.003.487 3.138.487s2.28-.174 3.138-.487c.778-.284 1.268-.65 1.528-1.126.186-.34.273-.775.29-1.389A3.001 3.001 0 0115 6a3 3 0 013 3c0 1.29-.813 2.39-1.956 2.816-.021.88-.182 1.63-.558 2.317-.492.9-1.34 1.573-2.428 1.97-1.066.389-2.36.597-3.558.597s-2.492-.208-3.558-.597c-1.088-.397-1.936-1.07-2.428-1.97-.376-.687-.537-1.438-.558-2.317A3.001 3.001 0 013 9a3 3 0 013-6zm0 2a1 1 0 100 2 1 1 0 000-2zm12 0a1 1 0 100 2 1 1 0 000-2zM12 21a3 3 0 01-3-3c0-1.29.813-2.39 1.956-2.816A3.001 3.001 0 0112 15a3 3 0 011.044.184A3.001 3.001 0 0115 18a3 3 0 01-3 3zm0-4a1 1 0 100 2 1 1 0 000-2z"/>
                </svg>
                {project.forks}
              </span>
            )}
          </div>
        </a>
      ))}
    </div>
  </div>
</section>

<style>
  .marquee-track {
    animation: marquee-scroll var(--marquee-duration) linear infinite;
  }

  .marquee-track:hover {
    animation-play-state: paused;
  }

  @keyframes marquee-scroll {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(-50%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee-track {
      animation-play-state: paused;
    }
  }
</style>
